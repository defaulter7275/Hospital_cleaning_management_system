<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
      lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Checklist - Hospital Cleaning</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4><i class="fas fa-clipboard-list me-2"></i> Create New Checklist</h4>
                </div>
                <div class="card-body">
                    <form th:action="@{/checklists/create}" th:object="${checklist}" method="post">
                        
                        <div class="mb-3">
                            <label for="name" class="form-label">Checklist Name *</label>
                            <input type="text" class="form-control" id="name" 
                                   th:field="*{name}" 
                                   placeholder="e.g., Daily OT Cleaning"
                                   required>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="floorId" class="form-label">Floor *</label>
                                <select class="form-select" id="floorId" 
                                        th:field="*{floorId}" 
                                        onchange="filterAreas()"
                                        required>
                                    <option value="">Select Floor</option>
                                    <option th:each="floor : ${floors}" 
                                            th:value="${floor.id}" 
                                            th:text="${floor.name}">First Floor</option>
                                </select>
                                <small class="text-muted">Total floors: <span th:text="${floors?.size() ?: 0}">0</span></small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="areaId" class="form-label">Area *</label>
                                <select class="form-select" id="areaId" 
                                        th:field="*{areaId}" 
                                        required>
                                    <option value="">Select Area</option>
                                    <option th:each="area : ${areas}" 
                                            th:value="${area.id}" 
                                            th:text="${area.name}"
                                            th:attr="data-floor-id=${area.floor?.id}">OT</option>
                                </select>
                                <small class="text-muted">Total areas: <span th:text="${areas?.size() ?: 0}">0</span></small>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="assignedToId" class="form-label">Assign To *</label>
                            <select class="form-select" id="assignedToId" 
                                    th:field="*{assignedToId}" 
                                    required>
                                <option value="">Select Staff Member</option>
                                <option th:each="user : ${users}" 
                                        th:value="${user.id}" 
                                        th:text="${user.fullName} + ' (' + ${user.role} + ')'">
                                    John Doe (STAFF)
                                </option>
                            </select>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            After creating the checklist, you can add tasks to it from the checklist details page.
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4">
                            <a th:href="@{/checklists}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i> Create Checklist
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function filterAreas() {
        const floorId = document.getElementById('floorId').value;
        const areaSelect = document.getElementById('areaId');
        const options = areaSelect.querySelectorAll('option');
        
        // Reset area selection
        areaSelect.value = '';
        
        // Show/hide areas based on selected floor
        options.forEach(option => {
            if (option.value === '') {
                option.style.display = 'block';
                return;
            }
            
            const optionFloorId = option.getAttribute('data-floor-id');
            if (!floorId || optionFloorId === floorId) {
                option.style.display = 'block';
            } else {
                option.style.display = 'none';
            }
        });
    }
    
    // Run filter on page load to show correct areas
    window.addEventListener('DOMContentLoaded', filterAreas);
</script>

</body>
</html>
